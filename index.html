<html>
<head>
	<title>xAPI Dashboard</title>
	<link rel='stylesheet' href='lib/nv.d3.css'></link>
	<script type="text/javascript" src="dist/xapicollection.min.js"></script>
	<script type="text/javascript" src="dist/xapidashboard.min.js"></script>
	
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
	
	<script src="extra/gen-lrs-data.js"></script>
</head>
<body ng-app="ebookDash">
	<style>
		.nv-axislabel {
			font-size: 18px;
		}
		#main{
			width: 100%;
		}
		svg{
			width: 50%;
			height: 50%;
			float:left;
			clear: left;
		}
		
		#svg{
			width: 65%;
			height: 55%;
			margin: 0 auto;
			float: none;
			
		}
		
		#svg2, #table, #table2{
			width: 40%;
			float: right;
			clear:right;
			text-align:center;
			min-height: 500px;
		}
		
		#children{
			width: 100%;
			clear:both;
			margin-top: -50px;
			padding: 70px 0;
		}
	</style>
	<div id="main">
		<svg id="svg"></svg>
	</div>
	<div id="children" ng-controller="sideBar">
		<h2 style="text-align:center;">{{sayStuff}}</h2>
		
		3 plus <input type="number" ng-model="someNum"></input> equals <span>{{ add3(someNum) }}</span>
		
		<svg id="svg5"></svg>
		<div id="table2"></div>
		
		<svg id="svg3"></svg>
		<svg id="svg2"></svg>
		
		<svg id="svg4"></svg>
		<div id="table"></div>
	</div>

	<script type="text/javascript">
		//To-do: add comments
		
		var dashModule = angular.module("ebookDash", []);
		dashModule.controller('sideBar', ['$scope', function($scope){
		
			$scope.sayStuff = "Hey there friend!";
			$scope.add3 = function(val){
				return val + 3;
			};
		}]);
	
		var wrapper = new XAPIWrapper({"endpoint" : 'https://lrs.adlnet.gov/xAPI/'});
		var dash = new ADL.XAPIDashboard('#svg');
		var saveTest = '', scoreArr, totalStudents = 30;
		
		dash.addStatements(window.statements);
		
		
		
		var minMaxAverage = dash.createMultiBarChart({
			pre: function(data){
				return data.where("result.score.raw != null").orderBy("object.definition.name");
			},
			aggregate: ADL.multiAggregate("result.score.raw", ADL.min, ADL.average, ADL.max),
			groupBy:  'object.definition.name',
			customize: function(nvd3Chart){
				nvd3Chart.forceY([0, 120]);
				nvd3Chart.yAxis.axisLabel("Grade");			
			}
		});

		var studentsInRange = dash.createBarChart({
			container: "#svg4",
			groupBy: 'actor.name',
			pre: function(data, event){
				return data.where('result.score.raw > 0').orderBy('result.score.raw', 'desc');
			},
			aggregate: ADL.select('result.score.raw'),
			customize: function(nvd3Chart, event){
				nvd3Chart.xAxis.rotateLabels(45).axisLabel("Student");
				nvd3Chart.yAxis.axisLabel("Grade");
				nvd3Chart.forceY(100);
			}
		});

		minMaxAverage.draw();	
		studentsInRange.draw();

		/*if( window.statements ){
			dash.addStatements(window.statements);
			window.statements = null;
			generateGraphs();
		}
		else {
			dash.fetchAllStatements({'since': new Date(Date.now() - set.day * 30).toISOString()}, wrapper, generateGraphs);
		}*/
	</script>
</body>
</html>
